{% if page.meta and page.meta.comments %}
<h2 id="__comments">ğŸ’¬ è¯„è®ºè®¨è®º</h2>
<div id="__comments_container" class="comments-container">
  <script>
    // æ ¹æ®å½“å‰ä¸»é¢˜è®¾ç½® Giscus ä¸»é¢˜
    function getGiscusTheme() {
      const palette = __md_get("__palette")
      if (palette && typeof palette.color === "object") {
        return palette.color.scheme === "slate" ? "dark" : "light"
      }
      return "light"
    }

    // åŠ¨æ€åŠ è½½ Giscus
    function loadGiscus() {
      const script = document.createElement('script');
      script.src = 'https://giscus.app/client.js';
      script.setAttribute('data-repo', 'dssast-tech/dssast-tech.github.io');
      script.setAttribute('data-repo-id', 'R_kgDOP9vGzQ'); // è¯·æ›¿æ¢ä¸ºä½ çš„å®é™…ä»“åº“ID
      script.setAttribute('data-category', 'General');
      script.setAttribute('data-category-id', 'DIC_kwDOP9vGzc4CwWVO'); // è¯·æ›¿æ¢ä¸ºä½ çš„å®é™…åˆ†ç±»ID
      script.setAttribute('data-mapping', 'pathname');
      script.setAttribute('data-strict', '0');
      script.setAttribute('data-reactions-enabled', '1');
      script.setAttribute('data-emit-metadata', '0');
      script.setAttribute('data-input-position', 'top'); // è¾“å…¥æ åœ¨é¡¶éƒ¨
      script.setAttribute('data-theme', getGiscusTheme());
      script.setAttribute('data-lang', 'zh-CN');
      script.setAttribute('crossorigin', 'anonymous');
      script.setAttribute('async', '');
      
      document.getElementById('__comments_container').appendChild(script);
    }

    // é¡µé¢åŠ è½½å®ŒæˆååŠ è½½è¯„è®º
    document.addEventListener('DOMContentLoaded', loadGiscus);

    // ä¸»é¢˜åˆ‡æ¢æ—¶é‡æ–°åŠ è½½è¯„è®º
    var ref = document.querySelector("[data-md-component=palette]")
    if (ref) {
      ref.addEventListener("change", function() {
        // æ¸…é™¤ç°æœ‰è¯„è®ºå¹¶é‡æ–°åŠ è½½
        const commentsContainer = document.getElementById('__comments_container');
        const existingGiscus = commentsContainer.querySelector('.giscus');
        if (existingGiscus) {
          existingGiscus.remove();
        }
        
        // é‡æ–°åŠ è½½è¯„è®º
        setTimeout(loadGiscus, 100);
      })
    }
  </script>
  
  <style>
    .comments-container {
      margin-top: 2rem;
    }
  </style>
</div>
{% endif %}